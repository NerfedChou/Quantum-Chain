use qc_06_mempool::domain::MempoolTransaction;
use qc_10_signature_verification::domain::entities::VerifiedTransaction;
use qc_10_signature_verification::ports::outbound::MempoolGateway;
use std::time::Duration;

#[derive(Clone)]
pub struct MockMempoolGateway;

#[async_trait::async_trait]
impl MempoolGateway for MockMempoolGateway {
    async fn submit_verified_transaction(
        &self,
        _tx: VerifiedTransaction,
    ) -> Result<(), qc_10_signature_verification::ports::outbound::MempoolError> {
        tokio::time::sleep(Duration::from_millis(1)).await; // Simulate IO
        Ok(())
    }
}

use qc_06_mempool::domain::entities::{SignedTransaction, U256};

pub fn create_tx(sender_byte: u8, nonce: u64, gas_price: u64, timestamp: u64) -> MempoolTransaction {
    let signed_transaction = SignedTransaction {
        from: [sender_byte; 20],
        to: Some([0xCC; 20]),
        value: U256::zero(),
        nonce,
        gas_price: U256::from(gas_price),
        gas_limit: 21000,
        data: vec![1, 2, 3, 4],
        signature: [0u8; 64],
    };
    MempoolTransaction::new(signed_transaction, timestamp)
}
