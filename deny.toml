# ==============================================================================
# Cargo Deny Configuration
# ==============================================================================
# Configuration for cargo-deny to check dependencies for:
# - Security advisories
# - License compliance
# - Duplicate dependencies
# - Banned crates
#
# Architecture Reference: Documentation/Architecture.md V2.3
# Run: cargo deny check
# ==============================================================================

[graph]
# Target platforms for dependency resolution
targets = [
    "x86_64-unknown-linux-gnu",
    "aarch64-unknown-linux-gnu",
]
all-features = true

# ==============================================================================
# Advisory Database Configuration
# ==============================================================================
[advisories]
db-path = "~/.cargo/advisory-db"
db-urls = ["https://github.com/rustsec/advisory-db"]
vulnerability = "deny"
unmaintained = "warn"
yanked = "warn"
notice = "warn"
ignore = [
    # Add advisory IDs to ignore here if needed (with justification)
    # Example: "RUSTSEC-2020-0001"
]

# ==============================================================================
# License Configuration
# ==============================================================================
[licenses]
# List of allowed licenses
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Unlicense",
    "Zlib",
    "CC0-1.0",
    "MPL-2.0",
    "Unicode-DFS-2016",
]
# Confidence threshold for license detection
confidence-threshold = 0.8
# Treat missing licenses as errors
unlicensed = "deny"
# Allow copyleft licenses (be careful with these)
copyleft = "warn"

# Specific crate license exceptions
[[licenses.clarify]]
name = "ring"
expression = "MIT AND ISC AND OpenSSL"
license-files = [
    { path = "LICENSE", hash = 0xbd0eed23 }
]

# ==============================================================================
# Bans Configuration
# ==============================================================================
[bans]
# Treat multiple versions of the same crate as a warning
multiple-versions = "warn"
# Wildcards in dependencies are not allowed
wildcards = "deny"
# Allow specific crates
allow = []
# Deny specific crates (security or policy reasons)
deny = [
    # Crates that have been deprecated or have security issues
    { name = "openssl", wrappers = ["openssl-sys"] },  # Prefer ring or rustls
]
# Skip checking specific crates (with justification)
skip = []
# Tree-skip specific crate paths
skip-tree = []

# ==============================================================================
# Sources Configuration
# ==============================================================================
[sources]
# Only allow crates from crates.io
unknown-registry = "deny"
unknown-git = "deny"
# Allow specific git sources if needed
allow-git = []

[sources.allow-org]
# Allow GitHub organizations (for internal dependencies)
github = []
