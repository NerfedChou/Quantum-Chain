# ============================================================================
# Quantum-Chain AMD GPU Docker Compose
# ============================================================================
# For AMD GPUs with ROCm or AMDGPU-PRO drivers.
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.gpu-amd.yml up --build
#
# Subsystems using GPU:
#   - QC-17 (Mining): SHA256 hashing - ~100x faster
#   - QC-10 (Signatures): ECDSA batch verification - ~50x faster  
#   - QC-03 (Merkle): Tree computation - ~20x faster
# ============================================================================

services:
  quantum-chain:
    build:
      context: ..
      dockerfile: Dockerfile
      args:
        ENABLE_GPU: "true"
    
    # AMD GPU access via DRI
    devices:
      - /dev/dri:/dev/dri
      - /dev/kfd:/dev/kfd  # ROCm kernel fusion driver
    
    group_add:
      - video
      - render
    
    environment:
      # GPU compute settings (auto-detected at runtime)
      QC_COMPUTE_BACKEND: "auto"  # auto, vulkan, opencl, cpu
      
      # AMD-specific
      AMD_VULKAN_ICD: "RADV"  # Use RADV (open source) or AMDVLK
      
      # ROCm settings (if using ROCm)
      HSA_OVERRIDE_GFX_VERSION: "10.3.0"  # Adjust for your GPU
